<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cali Fast Drive</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#050505;
  --card:#0f0f0f;
  --gold:#d4af37;
  --gold2:#c9a14a;
  --text:#f5f5f5;
}

body{
  background: radial-gradient(circle at top, var(--bg) 0%, #000 60%);
  color: var(--text);
  font-family: Arial;
  margin:0;
  text-align:center;
}

/* SPLASH SCREEN */
#splash{
    position:fixed;
    inset:0;
    background:#000;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
#splash img{
    width:70%;
    max-width:320px;
    margin-bottom:30px;
    animation: logoIn 1.5s ease;
}
@keyframes logoIn{
    from{ transform:scale(0.3); opacity:0; }
    to{ transform:scale(1); opacity:1; }
}

#enterBtn{
  background: linear-gradient(90deg,#d4af37,#ffea70,#d4af37);
  color:#000;
  font-weight:bold;
  padding:18px 40px;
  border-radius:40px;
  font-size:20px;
  box-shadow: 0 0 40px rgba(255,215,0,.7);
  animation: pulse 1.5s infinite;
}
@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.05)}
  100%{transform:scale(1)}
  
}

#splash{
  transition: opacity .6s ease;
}

#muteBtn{
    margin-top:15px;
    background:var(--card);
    color:#fff;
    border:1px solid linear-gradient(135deg, var(--gold), var(--gold2));
    padding:8px 18px;
    border-radius:12px;
}

/* MENU */
.menu button{
    margin:5px;
    padding:15px;
    border-radius:12px;
    background:linear-gradient(135deg, var(--gold), var(--gold2));
    border:none;
    font-size:16px;
}
/* Zone qui contient les cartes */
#list {
  min-height: calc(100vh - 260px); /* espace restant sous header + cat√©gories */
  padding: 12px;
}

/* Mode normal (STUP / TABAC / PUFF) */
#list.grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

/* Mode INFO */
#list.info {
  display: flex;
  justify-content: center;
  align-items: center;
}


.card{
  backdrop-filter: blur(8px);
  background: rgba(20,20,20,.8);
}
@keyframes pop{
  from{opacity:0; transform:scale(.9)}
  to{opacity:1; transform:scale(1)}
}

.card{
  animation: pop .4s ease forwards;
}

.card{
  background: linear-gradient(145deg,#0a0a0a,#111);
  border-radius: 18px;
  padding: 0;
  overflow: hidden;
  box-shadow:
    0 0 15px rgba(255,200,60,0.15),
    0 0 40px rgba(255,180,30,0.05);
  border: 1px solid rgba(255,200,60,0.25);
  transition: all 0.25s ease;
}
.card::before{
  content:"";
  position:absolute;
  inset:0;
  background: linear-gradient(120deg,transparent,rgba(255,200,80,.3),transparent);
  opacity:0;
  transition:.4s;
}

.card:hover::before,
.card:active::before{
  opacity:1;
}

.card:active{
  transform: scale(.95);
  box-shadow: 0 0 40px rgba(255,200,60,.6);
}


video, img{
    width:100%;
    border-radius:15px;
}

/* OVERLAY PRODUIT */
#overlay {
    position: fixed;
    inset: 0;
    background: #000;
    display: none;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}
#overlayContent{
    max-width:500px;
    margin:auto;
}
#closeBtn{
    background:linear-gradient(135deg, var(--gold), var(--gold2));
    padding:10px 20px;
    border:none;
    border-radius:10px;
    margin-bottom:15px;
}
#overlayContent{
    max-width: 500px;
    margin: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
}
#overlay video{
    max-height: 65vh;
    object-fit: contain;
}
/* === TELEGRAM IPHONE FIX === */
button {
    min-height: 60px;
    min-width: 90%;
    font-size: 20px;
    font-weight: 700;
    border-radius: 18px;
}

/* Boutons cat√©gories (STUP / PUFF / TABAC / INFO) */
.category-btn {
    padding: 18px 24px !important;
    font-size: 22px !important;
    border-radius: 20px !important;
}
.card p{
  color:#ddd;
  font-size:14px;
  line-height:1.4;
}

.card h3{
  color: #ffd36b;
  font-weight: 700;
  letter-spacing: 1px;
  text-shadow: 0 0 10px rgba(255,200,60,.4);
}

/* Boutons dans les cartes */
.card button {
    padding: 16px 22px;
    font-size: 18px;
}

/* Bouton "Retour" overlay */
#overlay button {
    font-size: 20px;
    padding: 14px 20px;
    border-radius: 14px;
}

/* Zone tactile plus large */
button, .card {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
}

button{
  background: linear-gradient(135deg,#1a1a1a,#000);
  border: 1px solid #ffd36b;
  color:#ffd36b;
  font-size:18px;
  padding:18px;
  border-radius:18px;
  width:90%;
  margin:10px auto;
  box-shadow:0 0 20px rgba(255,200,60,0.2);
}

button:active{
  background: linear-gradient(135deg,#ffd36b,#ffb800);
  color:black;
}


#overlay{
  background: linear-gradient(180deg, #000, #050505);
}

#overlayContent{
  background: rgba(0,0,0,0.85);
  border:1px solid rgba(212,175,55,0.3);
  box-shadow:0 0 40px rgba(212,175,55,0.3);
  border-radius:20px;
}
#overlay{
  backdrop-filter: blur(10px);
  background: rgba(0,0,0,.95);
}

#overlay h2{
  color:#ffd36b;
  text-shadow:0 0 15px rgba(255,200,60,.5);
}

#overlay p{
  color:#ddd;
  font-size:16px;
}
#splash img{
  width:180px;
  animation: glow 2s infinite alternate;
}

@keyframes glow{
  from{
    filter: drop-shadow(0 0 10px gold);
    transform: scale(1);
  }
  to{
    filter: drop-shadow(0 0 35px #ffcc00);
    transform: scale(1.05);
  }
}
/* BARRE DES CATEGORIES */
#categories{
  position: sticky;
  top: 0;
  z-index: 999;
  
  display: flex;
  justify-content: center;
  gap: 12px;

  padding: 14px 12px;
  margin: 0;

  background: rgba(0,0,0,0.92);
  backdrop-filter: blur(10px);

  border-bottom: 1px solid rgba(255,255,255,0.05);
}
#categories::-webkit-scrollbar{ display:none; }

/* CHIP */
.cat-btn{
  padding: 10px 18px;
  border-radius: 14px;
  font-weight: 600;
  font-size: 14px;

  background: rgba(255,255,255,0.08);
  color: #aaa;

  transition: 0.25s;
}
.cat-btn:hover{
  background:rgba(255,255,255,0.18);
}

.cat-btn.active{
  background: linear-gradient(135deg, #00ff9d, #00c78a);
  color: black;
  box-shadow: 0 0 12px rgba(0,255,157,0.4);
}
#logoBar{
    display:flex;
    justify-content:center;
    margin:20px 0 10px;
}

.shop-logo{
    width:160px;
    max-width:70%;
    filter: drop-shadow(0 0 12px rgba(255,215,0,0.4));
}
/* === GOLD LUXURY GLOW === */
.info-card {
  width: 100%;
  max-width: 650px;
  background: radial-gradient(circle at top, #111, #000);
  border-radius: 22px;
  padding: 32px;
  color: white;
  border: 1px solid rgba(255,215,0,0.6);
  box-shadow: 
    0 0 30px rgba(255,215,0,0.35),
    inset 0 0 20px rgba(255,215,0,0.1);
}
.info-card h2 {
  color: gold;
  text-align: center;
  margin-bottom: 20px;
  text-shadow: 0 0 15px rgba(255,215,0,0.7);
}

.info-text{
  white-space: pre-wrap;
  line-height: 1.6;
  color: #eee;
}
.info-card pre {
  white-space: pre-wrap;
  font-family: inherit;
  font-size: 14px;
  line-height: 1.6;
  color: #ddd;
}
.info-full {
  min-height: calc(100vh - 220px); /* 220px ‚âà header + logo + cat√©gories */
  display: flex;
  align-items: center;      /* CENTRAGE VERTICAL */
  justify-content: center;  /* CENTRAGE HORIZONTAL */
  padding: 20px;
}

.info-card::before{
    content:"";
    position:absolute;
    inset:0;
    background: linear-gradient(135deg, rgba(255,215,0,0.08), rgba(0,0,0,0.95));
    pointer-events:none;
}
/* Titre gold */
.info-card h3{
    color:#FFD700;
    text-shadow: 0 0 8px rgba(255,215,0,0.7);
}

/* Texte */
.info-card p{
    white-space: pre-line;
}
/* Texte premium */
.info-card p{
    color: #f3e6b0;
    white-space: pre-line;
}
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash">
    <img src="assets/logo.jpg">
    <button id="enterBtn">Entrer dans le shop</button>
    <button id="muteBtn">üîä Son ON</button>
    <audio id="introSound" src="assets/intro.mp3" loop></audio>
</div>

<!-- MAIN APP -->
<div id="mainApp" style="display:none;">
  <div id="logoBar">
    <img src="assets/logo.jpg" class="shop-logo">
  </div>

  <div id="app"></div>
</div>

<script>
const enterBtn = document.getElementById("enterBtn");
const muteBtn = document.getElementById("muteBtn");
const splash = document.getElementById("splash");
const mainApp = document.getElementById("mainApp");
const sound = document.getElementById("introSound");
enterBtn.onclick = () => {
  // D√©marrer la musique (obligatoire sur iPhone via interaction)
  sound.muted = false;
  sound.play().catch(()=>{});

  // Animation splash ‚Üí app
  splash.style.opacity = "0";

  setTimeout(() => {
    splash.style.display = "none";
    mainApp.style.display = "block";
  }, 600);
};

muteBtn.onclick = () => {
  sound.muted = !sound.muted;
  muteBtn.textContent = sound.muted ? "üîá Son OFF" : "üîä Son ON";
};

let muted = false;

muteBtn.onclick = ()=>{
    muted = !muted;
    sound.muted = muted;
    muteBtn.textContent = muted ? "üîá Son OFF" : "üîä Son ON";
};

enterBtn.onclick = async ()=>{
    try { await sound.play(); } catch(e){}
    splash.style.display="none";
    mainApp.style.display="block";
};

const tg = Telegram.WebApp;
tg.expand();

const API = "https://telegram-miniapp-production-3c87.up.railway.app";

fetch(API + "/init", {
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body: JSON.stringify(tg.initDataUnsafe)
})
.then(r=>r.json())
.then(user => {

document.getElementById("app").innerHTML = `
<div id="categories">
  <div class="cat-btn active" data-cat="stup">üåø STUP</div>
  <div class="cat-btn" data-cat="tabac">üö¨ TABAC</div>
  <div class="cat-btn" data-cat="puff">üí® PUFF</div>
  <div class="cat-btn" data-cat="info">‚ÑπÔ∏è INFO</div>
</div>

<div id="list"></div>
`;

 // ACTIVER LES BOUTONS
 document.querySelectorAll(".cat-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        document.querySelectorAll(".cat-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        load(btn.dataset.cat);
    });
 });

 // Charger STUP au d√©marrage
 load("stup");
});


// === FONCTION LOAD (HORS du .then) ===
function load(cat) {
  fetch(API + "/products/" + cat)
    .then(r => r.json())
    .then(items => {

  // ===== MODE INFO (UNE SEULE CARTE FULLSCREEN) =====
  if (cat === "info") {
    const p = items[0]; // l'unique objet info

    document.getElementById("list").innerHTML = `
      <div class="info-full">
        <div class="info-card">
          <h2>‚ÑπÔ∏è ${p.title}</h2>
          <pre>${p.text}</pre>
        </div>
      </div>
    `;
    return;
  }

  // ===== MODE NORMAL (STUP / PUFF / TABAC) =====
  document.getElementById("list").innerHTML = items.map(p => `
    <div class="card" onclick='openProduct(${JSON.stringify(p)})'>
      ${p.video ? `<video src="${p.video}" playsinline autoplay muted loop></video>` : ""}
      ${p.image ? `<img src="${p.image}">` : ""}
      <div style="padding:20px">
        <h3>${p.name || p.title}</h3>
        <p style="color:#ccc;font-size:14px;line-height:1.4">
          ${p.desc || p.text || ""}
        </p>
      </div>
    </div>
  `).join("");
})

    .catch(err => {
      console.error(err);
      document.getElementById("list").innerHTML = "Erreur chargement";
    });
}

window.openProduct = function(p) {
    const overlay = document.getElementById("overlay");
    const content = document.getElementById("overlayContent");

    overlay.style.display = "block";

    content.innerHTML = `
  <div style="
    position: sticky;
    top: 0;
    background:#000;
    z-index:9999;
    padding:10px;
    text-align:center;
  ">
    <button onclick="closeOverlay()" style="
      width:100%;
      padding:12px;
      background:linear-gradient(135deg, var(--gold), var(--gold2));
      border:none;
      border-radius:10px;
      font-size:16px;
    ">
      ‚¨Ö Retour
    </button>
  </div>

  <h2 style="text-align:center; margin-top:15px">${p.name || p.title}</h2>

  <div style="width:100%; max-width:500px; margin:auto">
    ${p.video ? `<video src="${p.video}" autoplay playsinline loop controls style="width:100%; border-radius:15px"></video>` : ""}
    ${p.image ? `<img src="${p.image}" style="width:100%; border-radius:15px">` : ""}
  </div>

  <p style="
    padding:15px;
    text-align:center;
    font-size:16px;
    line-height:1.4;
    color:white;
  ">
    ${p.desc || ""}
  </p>
`;
}

window.closeOverlay = function() {
  document.getElementById("overlay").style.display="none";
}
</script>

<div id="overlay">
  <div id="overlayContent"></div>
</div>

</body>
</html>
