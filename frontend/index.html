<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cali Fast Drive</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#050505;
  --card:#0f0f0f;
  --gold:#d4af37;
  --gold2:#c9a14a;
  --text:#f5f5f5;
}

body{
  background: radial-gradient(circle at top, var(--bg) 0%, #000 60%);
  color: var(--text);
  font-family: Arial;
  margin:0;
  text-align:center;
}

/* SPLASH SCREEN */
#splash{
    position:fixed;
    inset:0;
    background:#000;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
#splash img{
    width:70%;
    max-width:320px;
    margin-bottom:30px;
    animation: logoIn 1.5s ease;
}
@keyframes logoIn{
    from{ transform:scale(0.3); opacity:0; }
    to{ transform:scale(1); opacity:1; }
}

#enterBtn{
    background:linear-gradient(135deg, var(--gold), var(--gold2));
    color:#000;
    border:none;
    padding:18px 30px;
    font-size:18px;
    border-radius:15px;
    font-weight:bold;
}

#muteBtn{
    margin-top:15px;
    background:var(--card);
    color:#fff;
    border:1px solid linear-gradient(135deg, var(--gold), var(--gold2));
    padding:8px 18px;
    border-radius:12px;
}

/* MENU */
.menu button{
    margin:5px;
    padding:15px;
    border-radius:12px;
    background:linear-gradient(135deg, var(--gold), var(--gold2));
    border:none;
    font-size:16px;
}

/* CARTES */
#list{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:12px;
    padding:10px;
}

.card{
  background: linear-gradient(145deg,#0a0a0a,#111);
  border-radius: 18px;
  padding: 0;
  overflow: hidden;
  box-shadow:
    0 0 15px rgba(255,200,60,0.15),
    0 0 40px rgba(255,180,30,0.05);
  border: 1px solid rgba(255,200,60,0.25);
  transition: all 0.25s ease;
}

.card:active{
  transform: scale(0.97);
  box-shadow:
    0 0 30px rgba(255,200,60,0.5),
    0 0 80px rgba(255,180,30,0.3);
}

video, img{
    width:100%;
    border-radius:15px;
}

/* OVERLAY PRODUIT */
#overlay {
    position: fixed;
    inset: 0;
    background: #000;
    display: none;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}
#overlayContent{
    max-width:500px;
    margin:auto;
}
#closeBtn{
    background:linear-gradient(135deg, var(--gold), var(--gold2));
    padding:10px 20px;
    border:none;
    border-radius:10px;
    margin-bottom:15px;
}
#overlayContent{
    max-width: 500px;
    margin: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
}
#overlay video{
    max-height: 65vh;
    object-fit: contain;
}
/* === TELEGRAM IPHONE FIX === */
button {
    min-height: 60px;
    min-width: 90%;
    font-size: 20px;
    font-weight: 700;
    border-radius: 18px;
}

/* Boutons cat√©gories (STUP / PUFF / TABAC / INFO) */
.category-btn {
    padding: 18px 24px !important;
    font-size: 22px !important;
    border-radius: 20px !important;
}
.card p{
  color:#ddd;
  font-size:14px;
  line-height:1.4;
}

.card h3{
  color: #ffd36b;
  font-weight: 700;
  letter-spacing: 1px;
  text-shadow: 0 0 10px rgba(255,200,60,.4);
}

/* Boutons dans les cartes */
.card button {
    padding: 16px 22px;
    font-size: 18px;
}

/* Bouton "Retour" overlay */
#overlay button {
    font-size: 20px;
    padding: 14px 20px;
    border-radius: 14px;
}

/* Zone tactile plus large */
button, .card {
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
}

button{
  background: linear-gradient(135deg,#1a1a1a,#000);
  border: 1px solid #ffd36b;
  color:#ffd36b;
  font-size:18px;
  padding:18px;
  border-radius:18px;
  width:90%;
  margin:10px auto;
  box-shadow:0 0 20px rgba(255,200,60,0.2);
}

button:active{
  background: linear-gradient(135deg,#ffd36b,#ffb800);
  color:black;
}


#overlay{
  background: linear-gradient(180deg, #000, #050505);
}

#overlayContent{
  background: rgba(0,0,0,0.85);
  border:1px solid rgba(212,175,55,0.3);
  box-shadow:0 0 40px rgba(212,175,55,0.3);
  border-radius:20px;
}
#overlay{
  backdrop-filter: blur(10px);
  background: rgba(0,0,0,.95);
}

#overlay h2{
  color:#ffd36b;
  text-shadow:0 0 15px rgba(255,200,60,.5);
}

#overlay p{
  color:#ddd;
  font-size:16px;
}

</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash">
    <img src="assets/logo.jpg">
    <button id="enterBtn">Entrer dans le shop</button>
    <button id="muteBtn">üîä Son ON</button>
    <audio id="introSound" src="assets/intro.mp3" loop></audio>
</div>

<!-- MAIN APP -->
<div id="mainApp" style="display:none;">
    <h1>üöó Cali Fast Drive</h1>
    <div id="app"></div>
</div>

<script>
const enterBtn = document.getElementById("enterBtn");
const muteBtn = document.getElementById("muteBtn");
const splash = document.getElementById("splash");
const mainApp = document.getElementById("mainApp");
const sound = document.getElementById("introSound");

let muted = false;

muteBtn.onclick = ()=>{
    muted = !muted;
    sound.muted = muted;
    muteBtn.textContent = muted ? "üîá Son OFF" : "üîä Son ON";
};

enterBtn.onclick = async ()=>{
    try { await sound.play(); } catch(e){}
    splash.style.display="none";
    mainApp.style.display="block";
};

const tg = Telegram.WebApp;
tg.expand();

const API = "https://telegram-miniapp-production-3c87.up.railway.app";

fetch(API + "/init", {
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body: JSON.stringify(tg.initDataUnsafe)
})
.then(r=>r.json())
.then(user => {
  document.getElementById("app").innerHTML = `
    <h3>Bienvenue ${user.received.user.first_name}</h3>
    <div class="menu">
      <button onclick="load('stup')">üî• STUP</button>
      <button onclick="load('puff')">üí® PUFF</button>
      <button onclick="load('tabac')">üö¨ TABAC</button>
      <button onclick="load('info')">‚ÑπÔ∏è INFO</button>
    </div>
    <div id="list"></div>
  `;
});

function load(cat){
  fetch(API + "/products/" + cat)
  .then(r=>r.json())
  .then(items=>{
    document.getElementById("list").innerHTML = items.map(p=>`
      <div class="card" onclick='openProduct(${JSON.stringify(p)})'>
        ${p.video ? `<video src="${p.video}" playsinline autoplay muted loop></video>` : 
         p.image ? `<img src="${p.image}">` :
         `<div style="padding:20px">
           <h3>${p.name || p.title || ""}</h3>
           <p style="color:#ccc;font-size:14px;line-height:1.4">${p.desc || p.text || ""}</p>
          </div>`}
        ${p.name ? `<h4>${p.name}</h4>` : ``}
      </div>
    `).join("");
  });
}

function openProduct(p){
    const overlay = document.getElementById("overlay");
    const content = document.getElementById("overlayContent");

    overlay.style.display = "block";

    content.innerHTML = `
  <div style="
    position: sticky;
    top: 0;
    background:#000;
    z-index:9999;
    padding:10px;
    text-align:center;
  ">
    <button onclick="closeOverlay()" style="
      width:100%;
      padding:12px;
      background:linear-gradient(135deg, var(--gold), var(--gold2));
      border:none;
      border-radius:10px;
      font-size:16px;
    ">
      ‚¨Ö Retour
    </button>
  </div>

  <h2 style="text-align:center; margin-top:15px">${p.name || p.title}</h2>

  <div style="width:100%; max-width:500px; margin:auto">
    ${p.video ? `<video src="${p.video}" autoplay playsinline loop controls style="width:100%; border-radius:15px"></video>` : ""}
    ${p.image ? `<img src="${p.image}" style="width:100%; border-radius:15px">` : ""}
  </div>

  <p style="
    padding:15px;
    text-align:center;
    font-size:16px;
    line-height:1.4;
    color:white;
  ">
    ${p.desc || ""}
  </p>
`;
}

function closeOverlay(){
  document.getElementById("overlay").style.display="none";
}
</script>

<div id="overlay">
  <div id="overlayContent"></div>
</div>

</body>
</html>
